<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>Rounds &#8211; oTree</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="oTree : A software platform for economics experiments">
    <meta name="author" content="Chris Wickens">
    
    <link rel="canonical" href="/wiki/Rounds/">

    <!--JS libraries-->
    <script type="text/javascript" src="//code.jquery.com/jquery-1.11.0.min.js"></script>
    <script type="text/javascript" src="//code.jquery.com/jquery-migrate-1.2.1.min.js"></script>
    <script src="/js/lightbox.min.js"></script>
    <script src="/js/owl.carousel.min.js"></script>
    <!-- Custom CSS -->
    <link rel="stylesheet" href="/css/owl.carousel.css">
    <link rel="stylesheet" href="/css/owl.theme.css">
    <link rel="stylesheet" href="/css/pixyll.css" type="text/css">
    <link href="/css/lightbox.css" rel="stylesheet" />

    <!-- Fonts -->
    <link href='//fonts.googleapis.com/css?family=Merriweather:900,900italic,300,300italic' rel='stylesheet' type='text/css'>
    <link href='//fonts.googleapis.com/css?family=Lato:900,300' rel='stylesheet' type='text/css'>
    

    <!-- Open Graph -->
    <!-- From: https://github.com/mmistakes/hpstr-jekyll-theme/blob/master/_includes/head.html -->
    <meta property="og:locale" content="en_US">
    <meta property="og:type" content="article">
    <meta property="og:title" content="Rounds">
    <meta property="og:description" content="oTree : A software platform for economics experiments">
    <meta property="og:url" content="/wiki/Rounds/">
    <meta property="og:site_name" content="oTree">
</head>

<body class="">
  <div class="site-wrap">
    <header class="site-header px2 px-responsive">
  <div class="mt2 wrap">
    <div class="measure">
        <a href="/" class="site-title">oTree</a>
      <nav class="site-nav right">
        <a href="/">Home</a>
<a href="/samplegames/">Sample games</a>
<a href="/wiki/Home">Wiki</a>
<a href="/sourcecode/">Source Code</a>
<a href="/oTree.pdf">Paper</a>
<a href="/oTreeSlides.pdf">Slides</a>

      </nav>
      <div class="clearfix"></div>
      
    </div>
  </div>
</header>


    <div class="post p2 p-responsive wrap" role="main">
      <div class="measure">
        <table>
    <tr>
        <td valign="top">
            <div class="post">
                <header class="post-header">
                    <h1 class="h2">Rounds</h1>
                </header>
                <article class="post-content">
                    <h3>Round numbers</h3>

<p>Subsession objects have attributes <code>round_number</code>, which contains the current round number, starting from 1.</p>

<h3>Grouping and randomization</h3>

<p>For the first round, the players are randomly grouped with one another. By default, the groups chosen are kept the same for subsequent round. If you would like to change this, you can define either of the following methods in <code>models.py</code> on the <code>Subsession</code> model:</p>

<h4><code>def first_round_groups(self)</code></h4>

<p>[todo]</p>

<h4><code>def next_round_groups(self, current_round_group_matrix)</code></h4>

<p>This method defines how players should be grouped into groups with one another, e.g. partner grouping, stranger grouping, perfect stranger, etc.</p>

<p>The argument <code>current_round_group_matrix</code> is a matrix (list of lists) that represents how groups are assigned in the current round. In this matrix, each row defines the players in a group. For example, if you have a game with 2 players per group, and 6 players total (meaning 3 groups), this matrix would look something like:</p>

<p><code>[[&lt;P5&gt;,&lt;P4&gt;], [&lt;P2&gt;,&lt;P3&gt;], [&lt;P6&gt;,&lt;P1&gt;] ]</code></p>

<p>Looking at the first sub-list above, this means players 5 and 4 play together this round, and their <code>id_in_group</code> attributes would be 1 and 2, respectively. (So player 5&#39;s <code>id_in_group</code> would be 1.)</p>

<p>To change the group assignments for the next round, you should define an algorithm to permute <code>current_round_group_matrix</code> and return the permuted matrix. For example, if you want players to be reassigned to the same groups, you should just return the input argument as is, i.e.:</p>
<div class="highlight"><pre><code class="language-text" data-lang="text">def next_round_groups(self, current_round_group_matrix):
    return current_round_group_matrix
</code></pre></div>
<p>If you want players to be reassigned to the same groups but to have roles randomly shuffled around within their groups (e.g. so player 1 will either become player 2 or remain player 1), you would do this:</p>
<div class="highlight"><pre><code class="language-text" data-lang="text">def next_round_groups(self, current_round_group_matrix):
    group_matrix = current_round_group_matrix
    for group_list in group_matrix:
        random.shuffle(group_list)
    return group_matrix
</code></pre></div>
<p>[TODO: oTree should implement the most common grouping algorithms like stranger, perfect stranger, etc.]</p>

<h2>Accessing data from previous rounds</h2>

<p>Player objects have methods <code>in_previous_rounds()</code> and <code>in_all_rounds()</code> that returns a list of players representing the same participant in previous rounds of the same app. The difference is that <code>in_all_rounds()</code> includes the current round&#39;s player. For example, if you wanted to calculate a participant&#39;s payoff for all previous rounds of a game, plus the current one:</p>
<div class="highlight"><pre><code class="language-text" data-lang="text">    cumulative_payoff = sum([p.payoff for p in self.player.in_all_rounds()])
</code></pre></div>
<p>Similarly, subsession objects have methods <code>previous_rounds()</code> and <code>all_rounds()</code> that work the same way.</p>

<h2>Accessing data from previous subsessions in different apps</h2>

<p>The above method only works if the same app is repeated for multiple rounds. If you want to pass data between subsessions of different app types (e.g. the participant is in the questionnaire and needs to see data from their ultimatum game results), you should store this data in the participant object, which persists across subsessions. Each participant has a field called <code>vars</code>, which is a dictionary that can store any data about the player. For example, if you ask the participant&#39;s name in one subsession and you need to access it later, you would store it like this:</p>

<p><code>self.player.participant.vars[&#39;first name&#39;] = &#39;Chris&#39;</code></p>

<p>Then in a future subsession, you would retrieve this value like this:</p>

<p><code>self.player.participant.vars[&#39;first name&#39;]</code> # returns &#39;Chris&#39;</p>

<h2>Global variables</h2>

<p>For session-wide globals, you can use <code>session.vars</code>,
either through <code>player.participant.session.vars</code> or <code>player.subsession.session.vars</code> (both are equivalent).</p>

<p>This is a dictionary just like <code>participant.vars</code>.</p>

                </article>
            </div>
        </td>
        <td valign="top">
            <ul>
<li><a class="post-link" href="/wiki/Prerequisites">Prerequisites</a></li>
<li><a class="post-link" href="/wiki/PyCharm">PyCharm</a></li>
<li><a class="post-link" href="/wiki/Setup">Setup</a></li>
<li><a class="post-link" href="/wiki/Sessions">Sessions</a></li>
<li><a class="post-link" href="/wiki/Apps">Apps</a></li>
<li><a class="post-link" href="/wiki/Models">Models</a></li>
<li><a class="post-link" href="/wiki/Views">Views</a></li>
<li><a class="post-link" href="/wiki/Templates">Templates</a></li>
<li><a class="post-link" href="/wiki/Rounds">Rounds</a></li>
<li><a class="post-link" href="/wiki/Trying-Your-App">Trying Your App</a></li>
<li><a class="post-link" href="/wiki/Test-Bots">Test Bots</a></li>
<li><a class="post-link" href="/wiki/Admin">Admin</a></li>
<li><a class="post-link" href="/wiki/Running-Lab-Sessions">Running Lab Sessions</a></li>
<li><a class="post-link" href="/wiki/Deploying-on-Heroku">Deploying on Heroku</a></li>
<li><a class="post-link" href="/wiki/For-Django-Devs">For Django Devs</a></li>
<li><a class="post-link" href="/wiki/Kiosk-Mode">Kiosk Mode</a></li>
<li><a class="post-link" href="/wiki/Payment-PDF">Payment PDF</a></li>
<li><a class="post-link" href="/wiki/Export-Data">Export Data</a></li>
<li><a class="post-link" href="/wiki/AMT-Integration">AMT Integration</a></li>
<li><a class="post-link" href="/wiki/Debug-Info">Debug Info</a></li>
<li><a class="post-link" href="/wiki/Progress-Monitor">Progress Monitor</a></li>
<li><a class="post-link" href="/wiki/Session-Interface">Session Interface</a></li>
<li><a class="post-link" href="/wiki/User-Input-Validation">User Input Validation</a></li>
</ul>

        </td>
    </tr>
</table>

      </div>
    </div>
  </div>

  <footer class="footer">
  <div class="p2 wrap">
    <div class="measure mt1 center">
      <small>
        <a href="/sourcecode">License</a>
      </small>
    </div>
  </div>
</footer>


<script>
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-53910404-1', 'auto');
ga('send', 'pageview');

</script>


</body>
</html>
