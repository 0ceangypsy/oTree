<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>Test Bots &#8211; oTree</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="oTree : A software platform for economics experiments">
    <meta name="author" content="Chris Wickens">
    
    <link rel="canonical" href="/wiki/Test-Bots/">

    <!--JS libraries-->
    <script type="text/javascript" src="//code.jquery.com/jquery-1.11.0.min.js"></script>
    <script type="text/javascript" src="//code.jquery.com/jquery-migrate-1.2.1.min.js"></script>
    <script src="/js/lightbox.min.js"></script>
    <script src="/js/owl.carousel.min.js"></script>
    <!-- Custom CSS -->
    <link rel="stylesheet" href="/css/owl.carousel.css">
    <link rel="stylesheet" href="/css/owl.theme.css">
    <link rel="stylesheet" href="/css/pixyll.css" type="text/css">
    <link href="/css/lightbox.css" rel="stylesheet" />

    <!-- Fonts -->
    <link href='//fonts.googleapis.com/css?family=Merriweather:900,900italic,300,300italic' rel='stylesheet' type='text/css'>
    <link href='//fonts.googleapis.com/css?family=Lato:900,300' rel='stylesheet' type='text/css'>
    

    <!-- Open Graph -->
    <!-- From: https://github.com/mmistakes/hpstr-jekyll-theme/blob/master/_includes/head.html -->
    <meta property="og:locale" content="en_US">
    <meta property="og:type" content="article">
    <meta property="og:title" content="Test Bots">
    <meta property="og:description" content="oTree : A software platform for economics experiments">
    <meta property="og:url" content="/wiki/Test-Bots/">
    <meta property="og:site_name" content="oTree">
</head>

<body class="">
  <div class="site-wrap">
    <header class="site-header px2 px-responsive">
  <div class="mt2 wrap">
    <div class="measure">
        <a href="/" class="site-title">oTree</a>
      <nav class="site-nav right">
        <a href="/">Home</a>
<a href="/samplegames/">Sample games</a>
<a href="/wiki/Home">Wiki</a>
<a href="/sourcecode/">Source Code</a>
<a href="/oTree.pdf">Paper</a>
<a href="/oTreeSlides.pdf">Slides</a>

      </nav>
      <div class="clearfix"></div>
      
    </div>
  </div>
</header>


    <div class="post p2 p-responsive wrap" role="main">
      <div class="measure">
        <table>
    <tr>
        <td valign="top">
            <div class="post">
                <header class="post-header">
                    <h1 class="h2">Test Bots</h1>
                </header>
                <article class="post-content">
                    <p>Automated tests are an essential part of building a oTree app. You can easily program a bot that simulates multiple players simultaneously playing your app.</p>

<p>Tests with dozens of bots complete with in seconds, and afterward automated tests can be run to verify correctness of the app (e.g. to ensure that payoffs are being calculated correctly).</p>

<p>This automated test system saves the programmer the time and frustration of having to re-test the application every time something is changed.</p>

<h3>Launching tests</h3>

<p>oTree tests entire sessions, rather that individual apps in isolation. This is to make sure the entire session runs, just as participants will play it in the lab.</p>

<p>Let&#39;s say you want to test the session named <code>ultimatum_game</code> in <code>sessions.py</code>. To test, run the following command from your project&#39;s root directory:</p>
<div class="highlight"><pre><code class="language-text" data-lang="text">./otree test ultimatum_game
</code></pre></div>
<p>This command will test the session, with the number of participants specified in <code>sessions.py</code>. For example, <code>num_bots</code> is 30, then when you run the tests, 30 bots will be instantiated and will play concurrently.</p>

<p>To run tests for all sessions in <code>sessions.py</code>, run:</p>
<div class="highlight"><pre><code class="language-text" data-lang="text">./otree test
</code></pre></div>
<h3>Writing tests</h3>

<p>Tests are contained in your app&#39;s <code>tests.py</code>. Fill out the <code>play()</code> method of your <code>PlayerBot</code> (and <code>ExperimenterBot</code> if you have experimenter pages. It should simulate each page submission. For example:</p>
<div class="highlight"><pre><code class="language-text" data-lang="text">self.submit(views.Start)
self.submit(views.Offer, {&#39;offer_amount&#39;: 50})
</code></pre></div>
<p>Here, we first submit the <code>Start</code> page, which does not contain a form. The next page is <code>Offer</code>, which contains a form whose field is called <code>offer_amount</code>, which we set to <code>50</code>. This is a way of automating the task of </p>

<p>Your test bot must simulate playing the game correctly. The bot in the above example would raise an error if the page after <code>Start</code> was called <code>Instructions</code> rather than <code>Offer</code>, or if the field <code>offer_amount</code> was actually called something else. Your test bot is a specification of how you expect your app to work, so when it raises an error, it will alert you that your app is not behaving as intended.</p>

<p>Rather than programming many separate bots, you program one bot that can play any variation of the game. For example, if you have different treatment groups that play different pages, you can branch by checking a variable on the treatment. For example, here is how you would play if one treatment group sees a &quot;threshold&quot; page but the other treatment group should see an &quot;accept&quot; page:</p>
<div class="highlight"><pre><code class="language-text" data-lang="text">    if self.group.threshold:
        self.submit(views.Threshold, {&#39;offer_accept_threshold&#39;: 30})
    else:
        self.submit(views.Accept, {&#39;offer_accepted&#39;: True})
</code></pre></div>
<p>If player 1 in a group sees different pages from player 2, you can define separate methods <code>play_p1()</code> and <code>play_p2()</code> and branch like this:</p>
<div class="highlight"><pre><code class="language-text" data-lang="text">    if self.player.id_in_group == 0:
        self.play_p1()
    else:
        self.play_p2()
</code></pre></div>
<p>To get the maximal benefit, your bot should thoroughly test all parts of your code. Here are some ways you can test your app:</p>

<ul>
<li><p>Ensure that it correctly rejects invalid input. For example, if you ask the user to enter a number that is a multiple of 3, you can verify that entering 4 will be rejected by using the <code>submit_with_invalid_input</code> method as follows. This line of code will raise an error if the submission is <em>accepted</em>:</p>

<p><code>self.submit_with_invalid_input(views.EnterNumber, {&#39;multiple_of_3&#39;: 4})</code></p></li>
<li><p>You can put assert statements in the bot&#39;s <code>validate_play()</code> method to check that the correct values are being stored in the database. For example, if a player&#39;s bonus is defined to be 100 minus their offer, you can check your program is calculating it correctly as follows:</p>

<p><code>self.submit(views.Offer, {&#39;offer&#39;: 30})</code></p>

<p><code>assert self.player.bonus == 70</code></p></li>
<li><p>You can use random amounts to test that your program can handle any type of random input:</p>

<p><code>self.submit(views.Offer, {&#39;offer&#39;: random.randint(0,100)})</code></p></li>
</ul>

<p>Bots can either be programmed to simulate playing the game according to an ordinary strategy, or to test &quot;boundary conditions&quot; (e.g. by entering invalid input to see if the application correctly rejects it). Or yet the bot can enter random input on each page. </p>

<p>If your app has [[Experimenter Pages]], you can also implement the <code>play</code> method on the <code>ExperimenterBot</code>.</p>

                </article>
            </div>
        </td>
        <td valign="top">
            <ul>
<li><a class="post-link" href="/wiki/Prerequisites">Prerequisites</a></li>
<li><a class="post-link" href="/wiki/PyCharm">PyCharm</a></li>
<li><a class="post-link" href="/wiki/Setup">Setup</a></li>
<li><a class="post-link" href="/wiki/Sessions">Sessions</a></li>
<li><a class="post-link" href="/wiki/Apps">Apps</a></li>
<li><a class="post-link" href="/wiki/Models">Models</a></li>
<li><a class="post-link" href="/wiki/Views">Views</a></li>
<li><a class="post-link" href="/wiki/Templates">Templates</a></li>
<li><a class="post-link" href="/wiki/Rounds">Rounds</a></li>
<li><a class="post-link" href="/wiki/Trying-Your-App">Trying Your App</a></li>
<li><a class="post-link" href="/wiki/Test-Bots">Test Bots</a></li>
<li><a class="post-link" href="/wiki/Admin">Admin</a></li>
<li><a class="post-link" href="/wiki/Running-Lab-Sessions">Running Lab Sessions</a></li>
<li><a class="post-link" href="/wiki/Deploying-on-Heroku">Deploying on Heroku</a></li>
<li><a class="post-link" href="/wiki/For-Django-Devs">For Django Devs</a></li>
<li><a class="post-link" href="/wiki/Kiosk-Mode">Kiosk Mode</a></li>
<li><a class="post-link" href="/wiki/Payment-PDF">Payment PDF</a></li>
<li><a class="post-link" href="/wiki/Export-Data">Export Data</a></li>
<li><a class="post-link" href="/wiki/AMT-Integration">AMT Integration</a></li>
<li><a class="post-link" href="/wiki/Debug-Info">Debug Info</a></li>
<li><a class="post-link" href="/wiki/Progress-Monitor">Progress Monitor</a></li>
<li><a class="post-link" href="/wiki/Session-Interface">Session Interface</a></li>
<li><a class="post-link" href="/wiki/User-Input-Validation">User Input Validation</a></li>
</ul>

        </td>
    </tr>
</table>

      </div>
    </div>
  </div>

  <footer class="footer">
  <div class="p2 wrap">
    <div class="measure mt1 center">
      <small>
        <a href="/sourcecode">License</a>
      </small>
    </div>
  </div>
</footer>


<script>
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-53910404-1', 'auto');
ga('send', 'pageview');

</script>


</body>
</html>
